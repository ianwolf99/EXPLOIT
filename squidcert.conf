acl intermediate_fetching transaction_initiator certificate-fetching 
http_access allow intermediate_fetching

#acl Safe_ports port 777  # multiling http                       
acl CONNECT method CONNECT

http_port 3128 tcpkeepalive=60,30,3 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=20MB tls-cert=/usr/local/squid/etc/ssl_cert/squid-self-signed.crt tls-key=/usr/local/squid/etc/ssl_cert/squid-self-signed.key cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS options=NO_TLSv1,NO_SSLv3,SINGLE_DH_USE,SINGLE_ECDH_USE tls-dh=prime256v1:/usr/local/squid/etc/ssl_cert/squid-self-signed_dhparam.pem
sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s /usr/local/squid/var/logs/ssl_db -M 20MB
sslcrtd_children 5
ssl_bump server-first all
ssl_bump stare all
sslproxy_cert_error deny all

#cache_dir ufs /usr/local/squid/var/cache/squid 100 16 256
maximum_object_size 6 GB
cache_mem 8192 MB
cache_dir ufs /usr/local/squid/var/cache/squid 32000 16 256 # 32GB as Cache

refresh_pattern -i .(jar|zip|whl|gz|bz)  259200 20% 259200 ignore-reload ignore-no-store ignore-private override-expire
refresh_pattern -i conda.anaconda.org\/.* 259200 20% 259200 ignore-reload ignore-no-store ignore-private override-expire
refresh_pattern .  0 20% 4320

cache_peer shinyHost  parent 443 0 no-query originserver
acl shinyACL dstdomain cache.wimax-lb.com
cache_peer_access shinyHost allow shinyACL

acl localnet src   45.145.60.0/24 45.145.61.0/24 45.145.62.0/24

# Log settings
access_log /var/log/squid/access.log squid
access_log /var/log/squid/store.log
#access_log tcp://127.0.0.1:1025
cache_access_log /var/log/squid/cache-access.log
cache_log /var/log/squid/cache.log
cache_store_log /var/log/squid/store.log
# Customize error pages
error_directory /usr/share/squid/errors/en

# DNS options
dns_nameservers 8.8.8.8 8.8.4.4

# ACLs for caching specific websites and content categories
acl social_media dstdomain .shahed.com  .netflix.com  .twitter.com .instagram.com raw.githubusercontent.com .facebook.com
acl google_content dstdomain .google.com .googleusercontent.com
acl yahoo_content dstdomain .yahoo.com
acl markets_content dstdomain .amazon.com .ebay.com .aliexpress.com .walmart.com .bestbuy.com .target.com .newegg.com .etsy.com .groupon.com
acl games dstdomain .steamcommunity.com .gog.com .origin.com .xbox.com .xboxlive.com .pubg.com .playstation.com .psnprofiles.com
acl mobile_games dstdomain .play.google.com
acl pc_games dstdomain .steampowered.com
acl playstation_games dstdomain .store.playstation.com
acl os_updates dstdomain .windowsupdate.com
acl android_os_updates dstdomain .android.com .googleapis.com .gstatic.com
acl linux_os_updates dstdomain .ubuntu.com .debian.org .kernel.org .archlinux.org  .redhat.com .fedoraproject.org .centos.org
acl apple_updates dstdomain .apple.com  .icloud.com
acl news_outlets dstdomain .cnn.com .bbc.com  .nytimes.com .espn.com .bleacherreport.com .goal.com .si.com
acl windows_domains dstdomain .microsoft.com .windowsupdate.com .live.com .office.com .ibm.com
acl youtube dstdomain .youtube.com
acl youtube_video urlpath_regex \.(flv|mp4|avi|wmv)

# Caching for specific websites and content categories
#http_access allow cacheable_sites
http_access allow windows_domains
http_access allow social_media
http_access allow google_content
http_access allow yahoo_content
http_access allow markets_content
http_access allow games
http_access allow mobile_games
http_access allow pc_games
http_access allow playstation_games
http_access allow os_updates
http_access allow android_os_updates
http_access allow linux_os_updates
http_access allow news_outlets
#allow caching for cacheable sites

cache allow windows_domains
cache allow social_media
cache allow google_content
cache allow yahoo_content
cache allow markets_content
cache allow games
cache allow mobile_games
cache allow pc_games
cache allow playstation_games
cache allow os_updates
cache allow android_os_updates
cache allow linux_os_updates
cache allow news_outlets

#acl myIP src
acl fb_video_domains dstdomain .fbcdn.net
url_rewrite_access allow fb_video_domains

# Rewrite Facebook video URLs
url_rewrite_program /etc/squid/fb_video_rewrite.sh


acl fb_image_domains dstdomain .fbcdn.net
url_rewrite_access allow fb_image_domains

# Rewrite Facebook image URLs
url_rewrite_program /etc/squid/fb_image_rewrite.sh

# AV updates
refresh_pattern -i \.symantecliveupdate\.com\/.*\.(zip|7z|irn|[m|x][0-9][0-9]) 4320 100% 43200 reload-into-ims
refresh_pattern -i .*dnl.*\.geo\.kaspersky\.(com|ru)\/.*\.(zip|avc|kdc|nhg|klz|d[at|if]) 4320 100% 43200 reload-into-ims
refresh_pattern -i \.kaspersky-labs\.(com|ru)\/.*\.(cab|zip|exe|ms[i|p]) 4320 100% 43200 reload-into-ims
refresh_pattern -i \.kaspersky\.(com|ru)\/.*\.(cab|zip|exe|ms[i|p]|avc) 4320 100% 43200 reload-into-ims
refresh_pattern -i .update\.geo\.drweb\.com 4320 100% 43200 reload-into-ims
refresh_pattern -i \.avast.com\/.*\.(vp[u|aa]) 4320 100% 43200 reload-into-ims
refresh_pattern -i \.avg.com\/.*\.(bin) 4320 100% 43200 reload-into-ims

refresh_pattern -i \.(zip|[g|b]z2?|exe|ms[i|p]|cvd|cdiff|mar)$ 43200 100% 129600 reload-into-ims
#
acl CONNECT method CONNECT
http_access allow CONNECT

# Force Squid to download the whole file instead of partial content
range_offset_limit -1
quick_abort_min -1

acl localnet src 0.0.0.1-0.255.255.255  # RFC 1122 "this" network (LAN)
acl localnet src 10.0.0.0/8             # RFC 1918 local private network (LAN)
acl localnet src 100.64.0.0/10          # RFC 6598 shared address space (CGN)
acl localnet src 169.254.0.0/16         # RFC 3927 link-local (directly plugged) machines
acl localnet src 172.16.0.0/12          # RFC 1918 local private network (LAN)
acl localnet src 192.168.0.0/16         # RFC 1918 local private network (LAN)
acl localnet src fc00::/7               # RFC 4193 local private network range
acl localnet src fe80::/10              # RFC 4291 link-local (directly plugged) machines
#acl localnet src  10.100.180.0/24
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http

